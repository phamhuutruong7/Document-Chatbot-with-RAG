graph TD
    %% Document Ingestion Data Flow
    subgraph "ğŸ“„ Document Ingestion Pipeline"
        A["ğŸ“ Raw Document<br/>(PDF/DOCX/TXT)"] --> B["ğŸ“ Extracted Text<br/>+ Metadata"]
        B --> C["ğŸ“‹ Text Chunks<br/>(with overlap)"]
        C --> D["ğŸ”¢ Vector Embeddings<br/>(1536 dimensions)"]
        D --> E["ğŸŒ² Stored Vectors<br/>(Pinecone Index)"]
    end
    
    %% Query Processing Data Flow
    subgraph "â“ Query Processing Pipeline"
        F["ğŸ’­ User Question<br/>(Natural Language)"] --> G{"ğŸ” Query Type<br/>Detection"}
        
        G -->|Special Command| H["âš¡ Command Data<br/>(/summarize, /translate)"]
        H --> H1["ğŸ“Š Command Result<br/>(Formatted Response)"]
        
        G -->|Complex Query| I["ğŸ¤– Agent Processing<br/>(Multi-step Reasoning)"]
        I --> I1["ğŸ”— Contextual Response<br/>(Agent-generated)"]
        
        G -->|Simple Query| J["ğŸ”¢ Query Embedding<br/>(Vector Representation)"]
        J --> K["ğŸ” Similarity Search<br/>(Top-K Results)"]
        K --> L["ğŸ“ Retrieved Context<br/>(Relevant Chunks)"]
        L --> M["ğŸ§  LLM Prompt<br/>(Context + Query)"]
        M --> N["ğŸ’¬ Generated Response<br/>(Natural Language)"]
    end
    
    %% Session Data Flow
    subgraph "ğŸ”„ Session Data Management"
        O["ğŸ†” Session ID<br/>(UUID)"] --> P["ğŸ“œ Chat History<br/>(Q&A Pairs)"]
        P --> Q["ğŸ’¾ Session File<br/>(JSON Storage)"]
        R["ğŸ“„ Document Metadata<br/>(Filename, Chunks)"]
        R --> Q
        S["âš™ï¸ User Preferences<br/>(Settings)"]
        S --> Q
    end
    
    %% Performance Data Flow
    subgraph "ğŸ“ˆ Monitoring Data Pipeline"
        T["â±ï¸ Operation Metrics<br/>(Timing, Tokens)"] --> U["ğŸ“Š Performance Data<br/>(Structured Logs)"]
        U --> V["ğŸ’¾ Local Metrics<br/>(JSON Files)"]
        U -.-> W["ğŸ“¡ LangSmith<br/>(Cloud Tracing)"]
    end
    
    %% Cross-Pipeline Data Connections
    E --> K  %% Stored vectors used in similarity search
    Q --> L  %% Session data provides context
    N --> P  %% Responses added to chat history
    H1 --> P %% Command results added to chat history
    I1 --> P %% Agent responses added to chat history
    
    %% Monitoring Connections
    F --> T  %% Query operations generate metrics
    A --> T  %% Document processing generates metrics
    
    %% Styling - High Contrast Data Flow
    classDef rawData fill:#1976d2,stroke:#ffffff,stroke-width:3px,color:#ffffff
    classDef processedData fill:#7b1fa2,stroke:#ffffff,stroke-width:3px,color:#ffffff
    classDef storedData fill:#388e3c,stroke:#ffffff,stroke-width:3px,color:#ffffff
    classDef outputData fill:#f57c00,stroke:#ffffff,stroke-width:3px,color:#ffffff
    classDef decisionPoint fill:#c2185b,stroke:#ffffff,stroke-width:3px,color:#ffffff
    classDef monitoring fill:#e91e63,stroke:#ffffff,stroke-width:3px,color:#ffffff
    
    class A,F rawData
    class B,C,D,J,L,M,H,I,T,U processedData
    class E,Q,V storedData
    class N,H1,I1,P outputData
    class G decisionPoint
    class W monitoring